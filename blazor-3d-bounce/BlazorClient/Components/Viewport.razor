@namespace BlazorClient.Components

<div class="viewport-container" 
     @ondragover="HandleDragOver" 
     @ondragover:preventDefault 
     @ondrop="HandleDrop"
     @ondrop:preventDefault>
    <canvas id="@CanvasId" class="viewport-canvas" tabindex="0"></canvas>
    
    <div class="viewport-overlay">
        @if (_isDragging)
        {
            <div class="drop-zone active">
                <div class="drop-zone-icon"><i class="bi bi-cloud-arrow-up"></i></div>
                <p>Drop GLTF/GLB file to load</p>
            </div>
        }
    </div>
    
    <div class="viewport-perf-overlay" style="position: absolute; top: 16px; right: 16px; z-index: 9999; pointer-events: auto;">
        <PerformanceOverlay Fps="@Fps" 
                           PhysicsTimeMs="@PhysicsTimeMs" 
                           RigidBodyCount="@RigidBodyCount" 
                           SoftBodyCount="@SoftBodyCount"
                           ActiveBackend="@ActiveBackend"
                           GpuInfo="@GpuInfo"
                           IsFallbackRenderer="@IsFallbackRenderer"
                           ShowRendererBadge="@ShowRendererBadge" />
    </div>
</div>

@code {
    /// <summary>
    /// The HTML canvas element ID.
    /// </summary>
    [Parameter]
    public string CanvasId { get; set; } = "renderCanvas";

    /// <summary>
    /// Callback when an object is selected in the viewport.
    /// </summary>
    [Parameter]
    public EventCallback<string?> OnObjectSelected { get; set; }

    /// <summary>
    /// Callback when a model file is dropped.
    /// </summary>
    [Parameter]
    public EventCallback<string> OnModelDropped { get; set; }

    /// <summary>
    /// Current frames per second.
    /// </summary>
    [Parameter]
    public float Fps { get; set; }

    /// <summary>
    /// Time spent in physics calculations (ms).
    /// </summary>
    [Parameter]
    public float PhysicsTimeMs { get; set; }

    /// <summary>
    /// Number of rigid bodies in the scene.
    /// </summary>
    [Parameter]
    public int RigidBodyCount { get; set; }

    /// <summary>
    /// Number of soft bodies in the scene.
    /// </summary>
    [Parameter]
    public int SoftBodyCount { get; set; }

    /// <summary>
    /// The active rendering backend (WebGPU, WebGL2, WebGL).
    /// </summary>
    [Parameter]
    public string? ActiveBackend { get; set; }

    /// <summary>
    /// GPU information string (vendor/renderer).
    /// </summary>
    [Parameter]
    public string? GpuInfo { get; set; }

    /// <summary>
    /// Whether the renderer is using a fallback backend.
    /// </summary>
    [Parameter]
    public bool IsFallbackRenderer { get; set; }

    /// <summary>
    /// Whether to show the renderer badge in the performance overlay.
    /// </summary>
    [Parameter]
    public bool ShowRendererBadge { get; set; } = true;

    private bool _isDragging;

    private void HandleDragOver(DragEventArgs e)
    {
        _isDragging = true;
    }

    private async Task HandleDrop(DragEventArgs e)
    {
        _isDragging = false;
        // File handling would be done via JS interop
        // This is a placeholder for the drag-and-drop functionality
    }
}
